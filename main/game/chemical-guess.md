# 化学猜一猜
### 规则
用户每次可以向 AI 提问一个 **一般疑问句**（需要用”是/否“回答的疑问句），AI 会用是/否回答这个问题，你需要利用最少的次数猜出隐藏的信息。

游戏模式包括三种：

+ 猜一种化学物质；
+ 猜一种化学反应；
+ 猜一句话（这句话可以是对某个化学物质性质的描述，也可以描述它能参与的一种化学反应）。

### 评分规则
见 [https://docs.gxwtf.cn/#/main/score](https://docs.gxwtf.cn/#/main/score)。

### 回答正确的判定方式

- 对于化学物质，你只需要正确猜对这种物质（可以是化学式、中文名、俗名等）即为猜测正确。
- 对于化学反应，你需要正确猜出反应物、生成物、反应条件（包括是否可逆，不包含配平）才可以判断为猜测正确。请特别注意，如果你提供的反应配平有误或未配平，也认为是作答正确。
- 对于一句话，你的猜测只需要与这句话含义类似即可，条件比较松。

### 数据公开

该游戏涉及的物质列表如下：

```javascript
const chemicalList = [
	// 单质
	'H2',
	'C',
	'N2',
	'O2',
	'Na',
	'Mg',
	'Al',
	'Si',
	'P',
	'S',
	'Cl2',
	'K',
	'Ca',
	'Fe',
	'Cu',
	'Zn',
	'I2',
	'Br2',
	'Ag',
	'Pb',
	'Mn',
	'Hg',
	// 氧化物
	'H2O',
	'H2O2',
	'CO2',
	'CO',
	'SO2',
	'SO3',
	'NO',
	'NO2',
	'Na2O',
	'Na2O2',
	'MgO',
	'Al2O3',
	'SiO2',
	'P2O5',
	'CaO',
	'Fe2O3',
	'Fe3O4',
	'FeO',
	'CuO',
	'Cu2O',
	'MnO2',
	'HgO',
	'Hg2O',
	'PbO2',
	// 氯化物
	'NaCl',
	'KCl',
	'CaCl2',
	'MgCl2',
	'AgCl',
	'HCl',
	'HClO',
	'NaClO',
	'Ca(ClO)2',
	'BaCl2',
	'FeCl2',
	'FeCl3',
	'CuCl2',
	// 硫酸盐
	'H2SO4',
	'Na2SO4',
	'CaSO4',
	'BaSO4',
	'CuSO4',
	'FeSO4',
	'Fe2(SO4)3',
	'NaHSO4',
	// 碳酸盐
	'H2CO3',
	'Na2CO3',
	'CaCO3',
	'BaCO3',
	'MgCO3',
	'NaHCO3',
	'Ca(HCO3)2',
	'Ba(HCO3)2',
	// 亚硫酸盐
	'H2SO3',
	'Na2SO3',
	'CaSO3',
	'BaSO3',
	'MgSO3',
	'NaHSO3',
	'Ca(HSO3)2',
	'Ba(HSO3)2',
	// 碱
	'NaOH',
	'KOH',
	'Ba(OH)2',
	'Ca(OH)2',
	'Mg(OH)2',
	'Cu(OH)2',
	'Fe(OH)2',
	'Fe(OH)3',
	'Al(OH)3',
	// 硝酸盐
	'HNO3',
	'NaNO3',
	'KNO3',
	'AgNO3',
	'Ba(NO3)2',
	'Ca(NO3)2',
	'Fe(NO3)2',
	'Fe(NO3)3',
	// 其它
	'KMnO4',
	'KClO3',
	'NaI',
	'KI',
	'Na2S',
	'FeS',
	'FeS2',
	'NH3',
	'NH3·H2O',
	'AgBr',
	'AgI',
	'Ag2S',
	'CH3COONa',
	'CH3COONH4',
	'KSCN',
	'Fe(SCN)3',
	'H2S',
	//有机物
	'CH4',
	'C2H6',
	'C2H4',
	'C2H5OH',
	'CH3COOH',
	'CCl4'
]; 
```

对于“猜化学物质”，系统会从上述列表中随机生成一种物质。

对于“猜化学反应”，系统会调用 AI 生成一个化学反应，相关代码如下：

```javascript
async function generateRandomReaction() {
	const chemicals = Array(10).fill(null).map(() => { return getRandomChemical() });
	// console.log(chemicals);
	const order = ['氧化还原反应', '沉淀反应', '酸碱反应'].sort(() => (Math.random() - 0.5));
	const prompt = `用户提供了一些化学物质：${JSON.stringify(chemicals, null, 2)},
    
你需要从中等概率随机挑选一个（可以先随机一种物质类型，比如酸、碱、盐、氧化物、其它，再从中随机挑选一种物质），然后生成关于这种物质的一个化学反应。（其余反应物可以不出现在用户提供的列表中）
为了提高生成的随机性，建议你列出几种可能的化学反应，然后从中等概率随机挑选一个。注意要等概率随机，不能只挑选那些典型的反应。
你必须按照该列表中的顺序选择反应类型：${JSON.stringify(order)}。也就是说，你需要从前往后依次考虑列表中的每一个反应类型，如果用户指定的物质列表中存在能发生这种反应的物质，你就需要选出这种物质能发生的这种类型的反应并输出。
    
注意：
1. 你生成的反应必须是高中化学必修一、二 无机化学部分的反应。
2. 如果反应可以写成离子方程式，一律写离子方程式，尽量避免使用化学方程式。（除非该反应的离子方程式与化学方程式相同）
3. 最终生成的反应（离子方程式）要在“常见”和“不常见”中随机挑选。


输出格式：
<reason>
    你的思考和推理过程，包括你如何挑选反应类型和反应物，请考虑充分后再输出
</reason>
你的最终输出，只输出这个化学反应，无多余内容。
`
	return deepseekChat(prompt);
}
```

对于“猜一句话”系统会调用 AI 生成一句话。这句话会对上述列表中的某一个物质进行描述（可以从物理性质、化学性质、以及与其它物质的反应等角度进行描述）。

具体代码如下：

```javascript
async function generateRandomSentence() {
	const chemicals = Array(10).fill(null).map(() => { return getRandomChemical() });
	const prompt = `用户提供了一些化学物质：${JSON.stringify(chemicals, null, 2)},你需要从中等概率随机挑选一个（可以先随机一种物质类型，比如酸、碱、盐、氧化物、其它，再从中随机挑选一种物质），然后生成关于这种物质的一个陈述句。
为了提高生成的随机性，建议你列出几句关于这种物质的句子，然后从中随机挑选一个。注意要等概率随机，不能只挑选那些典型的句子

注意：
1. 句子不宜太长，以降低猜测难度。
2. 生成的句子必须是简单句，不能包含“并且”等连接词。
3. 句子最多只能描述该物质的一个性质（比如：一条物理/化学性质，一个它能发生的化学反应）。
4. 生成的句子必须在高中化学必修一~二无机化学部分的范围内。

你应从该物质的以下角度描述：${["物理性质", "化学性质", "化学反应"][Math.floor(Math.random() * 3)]}

输出格式：
<reason>
    你的思考和推理过程
</reason>
你的最终输出，只输出这句话，无多余内容。
`

	return deepseekChat(prompt);
}
```

****

**AI 回答用户问题时的 Prompt 如下：**

```plain
你正在和用户玩一个名为“化学猜一猜“ 的游戏。用户的目标是猜出隐藏的化学物质/一个化学反应/一句话。每次用户可以向你提问一个一般疑问句，你需要回答这句话。

注意：
1. 用户每次必须提问一个一般疑问句（需要用 是/否/可能是 来回答的句子）。你只能通过用户的疑问句转换为陈述句来回答，例如：其具有xxx性质吗 -> 其具有xxx性质 / 其在少数情况下下可以具有xxx性质 / 其不具有xxx性质。当用户没有输入疑问句或问题不相关时，请输出"抱歉，我只能回答 “是” 或 “否”，且只能回答和化学有关的问题。" 唯一的例外就是用户一字不差地猜中了这个物质，此时你需要输出：“恭喜你，猜对了！”
2. 用户可能会提问“是 XXX（一个化学式） 吗”这样的疑问句，这表明用户认为自己猜出了答案。此时，如果用户猜测正确，你需要一字不差地输出“恭喜你，猜对了！”，否则如果用户猜测错误，请输出“不是”。
3. 在最终输出中，不能以任何形式提及隐藏的物质的名称，包括化学式，中文名，英文名和俗名。如果也不能完整提及这句话的内容。在 <reason> 标签中可以出现物质名称。
4. 你必须严格按照该物质具有的性质来回答。禁止推测或者编造科学事实。
5. 如果用户猜对了这个物质或者这句话，你需要一字不差地回答“恭喜你，猜对了！”
6. 按一般情况下考虑问题，无需考虑特殊情况，且不必考虑得太细。请忽略那些没有显著影响或者影响过慢的反应/的现象/结论。（例如某些微弱的电离、沉淀反应等）
7. 在高中所学的知识框架内回答问题，如果高中所学的内容与实际情况不符，也要考虑高中所学的知识框架。
8. 请按照以下格式输出：
    <reason>
        你的推理判断过程（条理清晰），按照上述注意事项，针对隐藏物质的性质，或者隐藏的句子，判断用户的问题为：1.在一般条件下成立（不考虑极端情况） 2. 用户的问题不够清晰，难以判断是否成立 3.永远不成立 （你不需要考虑极其罕见的极端条件）
    </reason>
    你的最终输出，为 “是的/难说/不/不是”

关于用户猜测正确的判定：
- 对于化学物质，用户只需要正确猜对这种物质（可以是化学式、中文名、俗名等）即为猜测正确。
- 对于化学反应，用户需要正确猜出反应物、生成物、反应条件（包括是否可逆）才可以判断为猜测正确。
- 对于一句话，用户的猜测只需要与这句话含义类似即可，条件可以适当放松。
如果用户的猜测符合以上条件，你需要输出“恭喜你，猜对了！”

游戏模式：${猜物质|猜化学反应|猜一句话}

隐藏的物质/句子：${XXX}

用户的问题：${XXX}
```

